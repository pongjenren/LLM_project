# 教授/助教視角的提問與澄清

下列問題與解答聚焦於本專案的架構、假設與潛在風險，供課堂討論或助教批改時參考。

## 1. 系統目標與範疇
- **問題**：專案的主要目標是什麼？是否只針對本地 PDF 資料進行問答？
- **解答**：專案旨在建立全本地的 RAG 系統，將個人 PDF 論文切分、嵌入並以 ChromaDB 建立向量庫，透過混合檢索與 Llama 3 GGUF 產生答案，不依賴外部 API。

## 2. 資料前處理與分塊策略
- **問題**：PDF 斷句與分塊長度如何設定？是否考慮表格或公式的處理？
- **解答**：預處理模組需確認分塊長度與重疊策略是否與模型上下文長度相符；若遇到表格/公式，應檢查是否以文字抽取或以佔位符處理，避免破壞語意一致性。

## 3. 向量化與索引
- **問題**：嵌入模型為何？是否有向量維度或正規化設定？
- **解答**：專案使用 E5-large-v2 作為嵌入，需確認是否有向量正規化與 ChromaDB 索引參數（如度量、top_k）與檢索需求一致。

## 4. 混合檢索（Hybrid Retrieval）
- **問題**：語意檢索與關鍵字/BM25 的融合方式為何？權重如何選擇？
- **解答**：程式指出採用 semantic + BM25 的 hybrid 檢索；需檢視權重設定與排序融合方式（例如分數加權或排序重排），並根據評測結果調整。

## 5. 模型推論與硬體需求
- **問題**：Llama 3 GGUF 的量化與執行環境假設是什麼？8GB VRAM 是否足夠？
- **解答**：README 建議使用 8B Instruct Q4_K_M GGUF，在 GPU 8GB 上可運行；若 VRAM ≥16GB 可使用未量化版本，需同步調整 `src/config.py` 與 `src/llm_gguf.py`。

## 6. 記憶模組
- **問題**：長期記憶的摘要策略與更新頻率為何？
- **解答**：專案描述有「自動摘要最近對話」的長期記憶，需確認摘要觸發條件（如對話回合數）、摘要長度以及如何影響後續檢索上下文。

## 7. 評測方法
- **問題**：評測資料與指標為何？是否有對照組（例如無 RAG、關鍵字基線）？
- **解答**：倉庫包含多份 `evaluation_results_*.json` 及 `eval_result_*.txt`，應確認評測腳本使用的指標（如 BLEU、ROUGE 或人工評分），並與 baseline（關鍵字檢索、vanilla RAG）做比較以驗證混合檢索的效益。

## 8. 安全與隱私
- **問題**：資料完全本地化是否覆蓋所有依賴？有無潛在外部呼叫（如遙測）？
- **解答**：設計目標為無外部 API；需審查依賴套件與 UI 元件，確保沒有外部傳輸，並在教學中提醒學生確認網路隔離設定。

## 9. UI/使用者體驗
- **問題**：Gradio 介面提供哪些控制項？是否支援多輪對話與來源引用顯示？
- **解答**：`main.py` 啟動 Gradio UI，應檢查前端是否顯示檢索來源、提供檔案上傳或重建向量庫的選項，並確保多輪對話時上下文與記憶模組同步更新。

## 10. 部署與可移植性
- **問題**：在不同環境（CPU/GPU、Windows/Linux）部署時需要哪些調整？
- **解答**：README 建議 CUDA 預編譯版本與 CPU 安裝指令；部署時需確認 `llama-cpp-python` 的編譯選項與模型路徑一致，並在低資源環境下調整 batch / context window 以避免 OOM。

## 11. 故障排查
- **問題**：若檢索結果品質低下，最先檢查哪些環節？
- **解答**：依序檢查：PDF 解析品質（OCR/文字抽取）、分塊設定、嵌入是否正常（向量維度、正規化）、ChromaDB 索引/查詢參數、混合檢索權重，以及 LLM 回答是否有過長截斷。

## 12. 潛在擴充
- **問題**：如何擴充為多語言或加入 reranker？
- **解答**：可替換嵌入模型為多語言版本（如 mE5）、加入 Cross-Encoder reranker 於檢索後排序，並調整前處理以支援多語言斷句；需同步更新評測資料以衡量效果。

## 13. 再現性與版本控管
- **問題**：是否提供隨機種子與版本鎖定？
- **解答**：應在訓練/評測腳本中設定隨機種子，並使用 `requirements.txt` 鎖定依賴版本；若需完全再現，建議記錄模型檔案的雜湊或下載來源。

## 14. 資料庫更新流程
- **問題**：新增或移除 PDF 後，向量庫如何同步？
- **解答**：README 提供 `build_db.py` 重新建庫流程；應提醒使用者在更新資料後重新執行，並避免舊向量與新文件混用造成語意污染。

## 15. 指令覆寫與提示設計
- **問題**：RAG pipeline 中的系統提示或 instruction 如何設計？
- **解答**：README 建議在評測時調整或移動 instruction；實務上應檢查提示是否鼓勵模型引用來源、避免幻覺，並在 UI 提供可配置的指令欄位以便實驗。

## 16. 效能監測
- **問題**：有無記錄延遲、吞吐與 GPU 記憶體使用？
- **解答**：目前文件未提供；建議在推論或檢索階段加入 profiling（如 latency log、GPU/CPU 記憶體追蹤），供課堂實驗或調優參考。

## 17. 法律與版權
- **問題**：處理的 PDF 是否涉及版權限制？
- **解答**：需提醒使用者確認所處理的文獻具備授權或合理使用範圍，並在教學中強調僅限個人研究用途，避免未經允許的公開散布。

## 18. 互動紀錄保存
- **問題**：聊天紀錄如何保存與清除？
- **解答**：需確認 UI 是否提供匯出/清除會話的功能，並評估 `data/memory.txt` 或其他存檔方式是否滿足隱私需求。

## 19. 例外處理
- **問題**：若模型或檢索服務啟動失敗，是否有清晰的錯誤訊息與回退策略？
- **解答**：建議在啟動流程加入錯誤攔截與提示（如模型路徑不存在、ChromaDB 連線失敗），並提供 fallback（例如改用 CPU 或減少 context）。

## 20. 教學與報告要求
- **問題**：若此專案作為課程作業，學生應提交哪些報告內容？
- **解答**：應要求學生描述資料集、模型選擇、檢索與提示策略、評測方法與結果、失敗案例分析，以及硬體環境設定，確保可重現性與分析深度。
